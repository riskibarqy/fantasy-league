openapi: 3.0.3
info:
  title: Fantasy League API
  version: 1.0.0
  description: Fantasy League backend API.
servers:
  - url: http://localhost:8080
paths:
  /healthz:
    get:
      summary: Health check
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/dashboard:
    get:
      summary: Get dashboard
      security:
        - bearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues:
    get:
      summary: List leagues
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/teams:
    get:
      summary: List teams by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/teams/{teamID}:
    get:
      summary: Get team details by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/TeamID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/teams/{teamID}/history:
    get:
      summary: Get team history by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/TeamID'
        - in: query
          name: limit
          required: false
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/teams/{teamID}/stats:
    get:
      summary: Get team stats by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/TeamID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/fixtures:
    get:
      summary: List fixtures by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/standings:
    get:
      summary: List official standings by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/standings/live:
    get:
      summary: List live standings by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/fixtures/{fixtureID}:
    get:
      summary: Get fixture details by league and fixture
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/FixtureIDPath'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/fixtures/{fixtureID}/events:
    get:
      summary: List fixture events by league and fixture
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/FixtureIDPath'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/players:
    get:
      summary: List players by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/players/{playerID}:
    get:
      summary: Get player details by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/PlayerID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/players/{playerID}/history:
    get:
      summary: Get player history by league
      parameters:
        - $ref: '#/components/parameters/LeagueID'
        - $ref: '#/components/parameters/PlayerID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/leagues/{leagueID}/lineup:
    get:
      summary: Get my lineup by league
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
    put:
      summary: Save my lineup by league
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LineupWriteRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/squads:
    post:
      summary: Upsert fantasy squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpsertSquadRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/squads/picks:
    post:
      summary: Pick fantasy squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PickSquadRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/player-stats:
    post:
      summary: Ingest player fixture stats
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestPlayerFixtureStatsRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/fixtures:
    post:
      summary: Ingest fixtures
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestFixturesRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/team-stats:
    post:
      summary: Ingest team fixture stats
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestTeamFixtureStatsRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/fixture-events:
    post:
      summary: Ingest fixture events
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestFixtureEventsRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/raw-payloads:
    post:
      summary: Ingest raw source payloads as JSONB
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestRawPayloadsRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/ingestion/standings:
    post:
      summary: Ingest league standings (live or final)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestLeagueStandingsRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/jobs/sync-schedule:
    post:
      summary: Run schedule sync orchestrator job
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InternalJobSyncRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/jobs/bootstrap:
    post:
      summary: Queue initial schedule-sync jobs to QStash
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InternalJobSyncRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/internal/jobs/sync-live:
    post:
      summary: Run live sync orchestrator job
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InternalJobSyncRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/onboarding/favorite-club:
    put:
      summary: Save onboarding favorite club
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OnboardingFavoriteClubRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/onboarding/pick-squad:
    post:
      summary: Complete onboarding pick squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OnboardingPickSquadRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/squads/me/players:
    get:
      summary: List players with in-squad flag
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueIDQuery'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
    post:
      summary: Add one player to my squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPlayerToSquadRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/squads/me:
    get:
      summary: Get my squad
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueIDQuery'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/points/summary:
    get:
      summary: Get my season points summary (total/average/highest)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueIDQuery'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/fantasy/points/players:
    get:
      summary: Get my player points by gameweek (optional gameweek filter)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueIDQuery'
        - $ref: '#/components/parameters/GameweekQueryOptional'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/custom-leagues:
    get:
      summary: List my custom leagues
      security:
        - bearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
    post:
      summary: Create custom league
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCustomLeagueRequest'
      responses:
        '201':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/custom-leagues/me:
    get:
      summary: List my custom leagues
      security:
        - bearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/custom-leagues/{groupID}:
    get:
      summary: Get custom league by id
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/GroupID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
    put:
      summary: Update custom league by id
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/GroupID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCustomLeagueRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
    delete:
      summary: Delete custom league by id
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/GroupID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/custom-leagues/join:
    post:
      summary: Join custom league by invite code
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinCustomLeagueRequest'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
  /v1/custom-leagues/{groupID}/standings:
    get:
      summary: Get custom league standings
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/GroupID'
      responses:
        '200':
          $ref: '#/components/responses/GoogleSuccess'
        default:
          $ref: '#/components/responses/GoogleError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    LeagueID:
      in: path
      name: leagueID
      required: true
      schema:
        type: string
    TeamID:
      in: path
      name: teamID
      required: true
      schema:
        type: string
    PlayerID:
      in: path
      name: playerID
      required: true
      schema:
        type: string
    GroupID:
      in: path
      name: groupID
      required: true
      schema:
        type: string
    FixtureIDPath:
      in: path
      name: fixtureID
      required: true
      schema:
        type: string
    LeagueIDQuery:
      in: query
      name: league_id
      required: true
      schema:
        type: string
    GameweekQueryOptional:
      in: query
      name: gameweek
      required: false
      schema:
        type: integer
        minimum: 1
  responses:
    GoogleSuccess:
      description: Google-style success envelope
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GoogleSuccessEnvelope'
    GoogleError:
      description: Google-style error envelope
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GoogleErrorEnvelope'
  schemas:
    GoogleSuccessEnvelope:
      type: object
      properties:
        apiVersion:
          type: string
          example: '2.0'
        data: {}
      required:
        - apiVersion
        - data
    GoogleErrorEnvelope:
      type: object
      properties:
        apiVersion:
          type: string
          example: '2.0'
        error:
          $ref: '#/components/schemas/GoogleErrorBody'
      required:
        - apiVersion
        - error
    GoogleErrorBody:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        status:
          type: string
        errors:
          type: array
          items:
            $ref: '#/components/schemas/GoogleErrorItem'
      required:
        - code
        - message
        - status
    GoogleErrorItem:
      type: object
      properties:
        domain:
          type: string
        reason:
          type: string
        message:
          type: string
      required:
        - domain
        - reason
        - message
    UpsertSquadRequest:
      type: object
      properties:
        league_id:
          type: string
        squad_name:
          type: string
        player_ids:
          type: array
          minItems: 15
          maxItems: 15
          items:
            type: string
      required:
        - league_id
        - squad_name
        - player_ids
    PickSquadRequest:
      type: object
      properties:
        league_id:
          type: string
        squad_name:
          type: string
        player_ids:
          type: array
          minItems: 15
          maxItems: 15
          items:
            type: string
      required:
        - league_id
        - player_ids
    LineupWriteRequest:
      type: object
      properties:
        leagueId:
          type: string
        goalkeeperId:
          type: string
        defenderIds:
          type: array
          minItems: 3
          maxItems: 5
          items:
            type: string
        midfielderIds:
          type: array
          minItems: 3
          maxItems: 5
          items:
            type: string
        forwardIds:
          type: array
          minItems: 1
          maxItems: 3
          items:
            type: string
        substituteIds:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: string
        captainId:
          type: string
        viceCaptainId:
          type: string
      required:
        - goalkeeperId
        - defenderIds
        - midfielderIds
        - forwardIds
        - substituteIds
        - captainId
        - viceCaptainId
    OnboardingFavoriteClubRequest:
      type: object
      properties:
        league_id:
          type: string
        team_id:
          type: string
      required:
        - league_id
        - team_id
    OnboardingPickSquadRequest:
      type: object
      properties:
        league_id:
          type: string
        squad_name:
          type: string
        player_ids:
          type: array
          minItems: 15
          maxItems: 15
          items:
            type: string
        goalkeeper_id:
          type: string
        defender_ids:
          type: array
          minItems: 3
          maxItems: 5
          items:
            type: string
        midfielder_ids:
          type: array
          minItems: 3
          maxItems: 5
          items:
            type: string
        forward_ids:
          type: array
          minItems: 1
          maxItems: 3
          items:
            type: string
        substitute_ids:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: string
        captain_id:
          type: string
        vice_captain_id:
          type: string
      required:
        - league_id
        - player_ids
        - goalkeeper_id
        - defender_ids
        - midfielder_ids
        - forward_ids
        - substitute_ids
        - captain_id
        - vice_captain_id
    AddPlayerToSquadRequest:
      type: object
      properties:
        league_id:
          type: string
        squad_name:
          type: string
        player_id:
          type: string
      required:
        - league_id
        - player_id
    CreateCustomLeagueRequest:
      type: object
      properties:
        league_id:
          type: string
        name:
          type: string
      required:
        - league_id
        - name
    UpdateCustomLeagueRequest:
      type: object
      properties:
        name:
          type: string
      required:
        - name
    JoinCustomLeagueRequest:
      type: object
      properties:
        invite_code:
          type: string
      required:
        - invite_code
    IngestPlayerFixtureStatsRequest:
      type: object
      properties:
        fixture_id:
          type: string
        stats:
          type: array
          items:
            $ref: '#/components/schemas/IngestPlayerFixtureStat'
      required:
        - fixture_id
        - stats
    IngestFixturesRequest:
      type: object
      properties:
        fixtures:
          type: array
          items:
            $ref: '#/components/schemas/IngestFixture'
      required:
        - fixtures
    IngestFixture:
      type: object
      properties:
        id:
          type: string
        league_id:
          type: string
        gameweek:
          type: integer
        home_team:
          type: string
        away_team:
          type: string
        home_team_id:
          type: string
        away_team_id:
          type: string
        fixture_ref_id:
          type: integer
          format: int64
        kickoff_at:
          type: string
          format: date-time
        venue:
          type: string
        home_score:
          type: integer
        away_score:
          type: integer
        status:
          type: string
        winner_team_id:
          type: string
        finished_at:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: true
      required:
        - id
        - league_id
        - gameweek
        - home_team
        - away_team
        - kickoff_at
    IngestPlayerFixtureStat:
      type: object
      properties:
        player_id:
          type: string
        team_id:
          type: string
        minutes_played:
          type: integer
        goals:
          type: integer
        assists:
          type: integer
        clean_sheet:
          type: boolean
        yellow_cards:
          type: integer
        red_cards:
          type: integer
        saves:
          type: integer
        fantasy_points:
          type: integer
        payload:
          type: object
          additionalProperties: true
      required:
        - player_id
        - team_id
    IngestTeamFixtureStatsRequest:
      type: object
      properties:
        fixture_id:
          type: string
        stats:
          type: array
          items:
            $ref: '#/components/schemas/IngestTeamFixtureStat'
      required:
        - fixture_id
        - stats
    IngestTeamFixtureStat:
      type: object
      properties:
        team_id:
          type: string
        possession_pct:
          type: number
        shots:
          type: integer
        shots_on_target:
          type: integer
        corners:
          type: integer
        fouls:
          type: integer
        offsides:
          type: integer
        payload:
          type: object
          additionalProperties: true
      required:
        - team_id
    IngestFixtureEventsRequest:
      type: object
      properties:
        fixture_id:
          type: string
        events:
          type: array
          items:
            $ref: '#/components/schemas/IngestFixtureEvent'
      required:
        - fixture_id
        - events
    IngestFixtureEvent:
      type: object
      properties:
        event_id:
          type: integer
          format: int64
        team_id:
          type: string
        player_id:
          type: string
        assist_player_id:
          type: string
        event_type:
          type: string
        detail:
          type: string
        minute:
          type: integer
        extra_minute:
          type: integer
        payload:
          type: object
          additionalProperties: true
      required:
        - event_type
    IngestRawPayloadsRequest:
      type: object
      properties:
        source:
          type: string
        records:
          type: array
          items:
            $ref: '#/components/schemas/IngestRawPayloadRecord'
      required:
        - records
    IngestRawPayloadRecord:
      type: object
      properties:
        entity_type:
          type: string
        entity_key:
          type: string
        league_id:
          type: string
        fixture_id:
          type: string
        team_id:
          type: string
        player_id:
          type: string
        source_updated_at:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: true
      required:
        - entity_type
        - entity_key
        - payload
    IngestLeagueStandingsRequest:
      type: object
      properties:
        league_id:
          type: string
        is_live:
          type: boolean
        gameweek:
          type: integer
          minimum: 1
        items:
          type: array
          items:
            $ref: '#/components/schemas/IngestLeagueStandingRecord'
      required:
        - league_id
        - items
    IngestLeagueStandingRecord:
      type: object
      properties:
        team_id:
          type: string
        position:
          type: integer
        played:
          type: integer
        won:
          type: integer
        draw:
          type: integer
        lost:
          type: integer
        goals_for:
          type: integer
        goals_against:
          type: integer
        goal_difference:
          type: integer
        points:
          type: integer
        form:
          type: string
        source_updated_at:
          type: string
          format: date-time
      required:
        - team_id
        - position
    InternalJobSyncRequest:
      type: object
      properties:
        league_id:
          type: string
        force:
          type: boolean
