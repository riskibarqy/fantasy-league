openapi: 3.0.3
info:
  title: Fantasy League API
  version: 1.0.0
  description: Fantasy League backend API for dashboard, leagues, fixtures, players, and lineup management.
servers:
  - url: http://localhost:8080
paths:
  /healthz:
    get:
      summary: Health check
      responses:
        '200':
          description: Service healthy
  /v1/dashboard:
    get:
      summary: Get dashboard summary
      responses:
        '200':
          description: Dashboard payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dashboard'
  /v1/leagues:
    get:
      summary: List leagues
      responses:
        '200':
          description: League list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/League'
  /v1/leagues/{leagueID}/fixtures:
    get:
      summary: List fixtures by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fixture list
  /v1/leagues/{leagueID}/fixtures/{fixtureID}/events:
    get:
      summary: List fixture events by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
        - in: path
          name: fixtureID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fixture events list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Fixture'
  /v1/leagues/{leagueID}/players:
    get:
      summary: List players by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Player list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Player'
  /v1/leagues/{leagueID}/players/{playerID}:
    get:
      summary: Get player details by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
        - in: path
          name: playerID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Player details with statistics and history
  /v1/leagues/{leagueID}/players/{playerID}/history:
    get:
      summary: Get player match history by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
        - in: path
          name: playerID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Player match history
  /v1/leagues/{leagueID}/lineup:
    get:
      summary: Get lineup by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Lineup payload or null when not set
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Lineup'
                  - type: 'null'
    put:
      summary: Save lineup by league
      parameters:
        - in: path
          name: leagueID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LineupWriteRequest'
      responses:
        '200':
          description: Saved lineup
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Lineup'
  /v1/fantasy/squads:
    post:
      summary: Upsert authenticated squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                league_id:
                  type: string
                squad_name:
                  type: string
                player_ids:
                  type: array
                  minItems: 15
                  maxItems: 15
                  items:
                    type: string
              required: [league_id, squad_name, player_ids]
      responses:
        '200':
          description: Squad upserted
  /v1/fantasy/squads/picks:
    post:
      summary: Pick authenticated squad
      description: Create or update current user's squad picks. `squad_name` is optional.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                league_id:
                  type: string
                squad_name:
                  type: string
                  description: Optional. When empty, existing squad name is reused or defaults to "My Squad".
                player_ids:
                  type: array
                  minItems: 15
                  maxItems: 15
                  items:
                    type: string
              required: [league_id, player_ids]
      responses:
        '200':
          description: Squad picked
  /v1/fantasy/squads/me:
    get:
      summary: Get authenticated squad
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: league_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Squad payload
  /v1/fantasy/squads/me/players:
    get:
      summary: List league players with in-squad flag for authenticated user
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: league_id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Players list for squad management
    post:
      summary: Add one player to authenticated squad
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                league_id:
                  type: string
                squad_name:
                  type: string
                  description: Optional. When empty, existing squad name is reused or defaults to "My Squad".
                player_id:
                  type: string
              required: [league_id, player_id]
      responses:
        '200':
          description: Updated squad payload
  /v1/custom-leagues:
    get:
      summary: List my custom leagues/groups with my rank and movement
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Custom league list with `my_rank` and `rank_movement` (`up|down|same|new`)
    post:
      summary: Create custom league/group
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                league_id:
                  type: string
                name:
                  type: string
              required: [league_id, name]
      responses:
        '201':
          description: Custom league created
  /v1/custom-leagues/me:
    get:
      summary: List my custom leagues/groups with my rank and movement
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Custom league list with `my_rank` and `rank_movement` (`up|down|same|new`)
  /v1/custom-leagues/{groupID}:
    get:
      summary: Get custom league/group by ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Custom league detail
    put:
      summary: Update custom league/group name
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
              required: [name]
      responses:
        '200':
          description: Custom league updated
    delete:
      summary: Delete custom league/group
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Custom league deleted
  /v1/custom-leagues/join:
    post:
      summary: Join custom league/group by invitation code
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                invite_code:
                  type: string
              required: [invite_code]
      responses:
        '200':
          description: Joined custom league
  /v1/custom-leagues/{groupID}/standings:
    get:
      summary: Get custom league/group standings
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Standings list
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Dashboard:
      type: object
      properties:
        gameweek:
          type: integer
        budget:
          type: number
        teamValue:
          type: number
        totalPoints:
          type: integer
        rank:
          type: integer
        selectedLeagueId:
          type: string
      required: [gameweek, budget, teamValue, totalPoints, rank, selectedLeagueId]
    League:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        countryCode:
          type: string
        logoUrl:
          type: string
      required: [id, name, countryCode, logoUrl]
    Fixture:
      type: object
      properties:
        id:
          type: string
        leagueId:
          type: string
        gameweek:
          type: integer
        homeTeam:
          type: string
        awayTeam:
          type: string
        homeTeamLogoUrl:
          type: string
        awayTeamLogoUrl:
          type: string
        kickoffAt:
          type: string
          format: date-time
        venue:
          type: string
      required: [id, leagueId, gameweek, homeTeam, awayTeam, homeTeamLogoUrl, awayTeamLogoUrl, kickoffAt, venue]
    Player:
      type: object
      properties:
        id:
          type: string
        leagueId:
          type: string
        name:
          type: string
        club:
          type: string
        position:
          type: string
          enum: [GK, DEF, MID, FWD]
        price:
          type: number
        form:
          type: number
        projectedPoints:
          type: number
        isInjured:
          type: boolean
        imageUrl:
          type: string
        teamLogoUrl:
          type: string
      required: [id, leagueId, name, club, position, price, form, projectedPoints, isInjured, imageUrl, teamLogoUrl]
    Lineup:
      type: object
      properties:
        leagueId:
          type: string
        goalkeeperId:
          type: string
        defenderIds:
          type: array
          minItems: 2
          maxItems: 5
          items:
            type: string
        midfielderIds:
          type: array
          maxItems: 5
          items:
            type: string
        forwardIds:
          type: array
          maxItems: 3
          items:
            type: string
        substituteIds:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: string
        captainId:
          type: string
        viceCaptainId:
          type: string
        updatedAt:
          type: string
          format: date-time
      required: [leagueId, goalkeeperId, defenderIds, midfielderIds, forwardIds, substituteIds, captainId, viceCaptainId, updatedAt]
    LineupWriteRequest:
      type: object
      properties:
        leagueId:
          type: string
        goalkeeperId:
          type: string
        defenderIds:
          type: array
          minItems: 2
          maxItems: 5
          items:
            type: string
        midfielderIds:
          type: array
          maxItems: 5
          items:
            type: string
        forwardIds:
          type: array
          maxItems: 3
          items:
            type: string
        substituteIds:
          type: array
          minItems: 4
          maxItems: 4
          items:
            type: string
        captainId:
          type: string
        viceCaptainId:
          type: string
        updatedAt:
          type: string
          format: date-time
      required: [goalkeeperId, defenderIds, midfielderIds, forwardIds, substituteIds, captainId, viceCaptainId]
